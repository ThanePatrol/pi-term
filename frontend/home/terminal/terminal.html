<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Document</title>
</head>
<body>
    <h1>Welcome to my webpage</h1>
    <p>This is some example content.</p>
    <iframe src="http://" style="width:100%;height:400px;" id="terminal-iframe"></iframe>
    <form action="/choose_terminal" method="POST" id="choose-terminal-form">
        <label for="node_ip">Enter node IP address</label>
        <input type="text" id="node_ip" name="node_ip">
        <label for="port">Enter port</label>
        <input type="text" id="port" name="port">
        <label for="baud_rate">Enter Baud Rate</label>
        <input type="text" id="baud_rate" name="baud_rate">
        <label for="user">Enter user</label>
        <input type="text" id="user" name="user">
        <input type="submit" value="Submit" id="form-submit-button">
    </form>

    <script>
        const form = document.querySelector("#choose-terminal-form");

        form.addEventListener('submit', event => {
            console.log("form submitted");
            event.preventDefault();
            const formData = new FormData(form);
            console.log("form data: ")
            console.log(formData);

            const urlSearchParams = new URLSearchParams();
            for (const pair of formData.entries()) {
                urlSearchParams.append(pair[0], pair[1]);
            }

            fetch('/choose_terminal', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: urlSearchParams.toString()
            })
                .then(response => {
                    response.json();
                })
                .catch(error => {
                    console.error(error);
                });

            updateIframe(form);
        });

        function updateIframe(form) {
            const elements = form.elements;
            const port = elements["port"].value;
            console.log("port is " + port);
            document.getElementById("terminal-iframe").src = "http://localhost:" + port;
        }

    </script>
</body>
</html>
